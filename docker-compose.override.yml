# ============================================
# MSIA Docker Compose 开发环境覆盖配置
# 用于本地开发时覆盖默认配置
# ============================================

version: '3.8'

services:
  db:
    ports:
      - "5432:5432"
    # 开发环境可以查看数据库日志
    command: postgres -c log_statement=all -c log_destination=stderr

  server:
    build:
      target: builder  # 使用构建阶段，包含开发依赖
    volumes:
      - ./server/src:/app/src:ro
      - ./server/prisma:/app/prisma:ro
      - uploads_data:/app/uploads
      - ./server/knowledge_base:/app/knowledge_base:ro
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    # 开发模式使用热重载
    command: ["npm", "run", "dev"]

  client:
    build:
      target: builder
    volumes:
      - ./client/src:/app/src:ro
      - ./client/public:/app/public:ro
      - ./client/index.html:/app/index.html:ro
    ports:
      - "8000:8000"
    # 开发模式使用 Vite 开发服务器
    command: ["npm", "run", "dev"]
